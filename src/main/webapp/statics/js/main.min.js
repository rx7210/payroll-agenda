var payRoll = (function(){
	
	function initCheckbox(){
		$('select').material_select();
	}
	
	function initKeyboard(){
		var agent=navigator.userAgent;
		if (agent.indexOf('Android')==-1) {
			$('#userId').keyboard();
			$('#password').keyboard(); 
		}
	}
	
	
	var message = {		
			  openMessageFailConnection : function (){
				$("#msg-black-shadow").animate({width:"100%"},0);
				$("#message-cont-conexion").animate({top:"0"},50);	
				setTimeout(message.validateConnection,1000); 
			},closeMessageFailConnection: function () {
				$("#msg-black-shadow").animate({width:"0%"},0);
		        $("#message-cont-conexion").animate({top:"-165px"},50);
		        setTimeout(message.validateConnection,1000); 
		    },validateConnection : function (){
		    	if(navigator.onLine){
		    		message.closeMessageFailConnection();
		    	}else{
		    		message.openMessageFailConnection(); 
		    	}
		    },openLoading: function (){
		    	$("#loading").animate({width:"100%"},0);
		    },initMessages : function (){
		    	$("#msg-close").click(message.closeMessageFailConnection);
		    	$("#msg-black-shadow").click(message.closeMessageFailConnection);
		    	alert("inicia");
		    	setTimeout(message.validateConnection,1000);
		    	console.info("Incia messages");
		    }
	};
	
	loginTablet = {
		login_Form : $("#loginForm"),
		load : function (){
			if (loginTablet.login_Form.length){
				loginTablet.login_Form.validate({
									rules : {
										userId : {
											required : true
										},
										password : {
											required : true 
										}
									},
									messages : {
										userId : {
											required : "El n&uacute;mero de registro es obligatorio"
										},
										password : {
											required : "La contrase&nacute;a es obligatoria" 
										}
									}
				});
				$("#btn-login").click(function (){	
					loginTablet.login_Form.submit();
					//message.openLoading();
				});
				console.info("Incia loginTablet");
			}
		}
	};
	
	menu = {
			menu_form 			: $("#menu-form"),
			left_white_shadow	: $('#left-white-shadow'),	
		   	left_menu			: $('#left-menu'),
		   	lm_close			: $("#lm-close"),
		    openLeftMenu : function (){
		   		menu.left_white_shadow.animate({width:"100%"},0);
				menu.left_menu.animate({left:'0px'},50);	
		   	},
		   	closeLeftMenu : function (){
				menu.left_white_shadow.animate({width:"0"},0);
				menu.left_menu.animate({left:'-340px'},0);
			},
			load : function (){
				if (menu.menu_form.length){
					menu.left_white_shadow.click(menu.closeLeftMenu);
					menu.lm_close.click(menu.closeLeftMenu);
				   	
				   	$("#lm-down").click(function (){
						message.openLoading();
						menu.menu_form.attr('action', '/payroll-agenda/exitAgenda');
						menu.menu_form.submit();
					});
					
					$("#lm-link-agenda").click(function (){
						message.openLoading();
						menu.closeLeftMenu();
						menu.menu_form.attr('action', '/payroll-agenda/homeAgenda');
						menu.menu_form.submit();
					});
					$("#lm-link-profile").click(function (){
						message.openLoading();
						menu.closeLeftMenu();
						menu.menu_form.attr('action', '/payroll-agenda/myProfile');
						menu.menu_form.submit();
					});
					console.info("Incia Menu");
				}
			}
	}
	
	activities = {
			actities_form : $("#activities-form"),
			burger : $("#burger"),
			getStartVisit : function (nameCompany,keyVisit){
				$("#activities-form").find("#nameCompany").val(unescape(nameCompany));
				$("#activities-form").find("#keyVisit").val(unescape(keyVisit));
//				message.openLoading();
				$("#activities-form").attr('action', '/payroll-agenda/startVisit');
				$("#activities-form").submit();
			},
			openRightAgenda : function (nameCompany,keyVisit,proposedDate){
	    		$("#companyNameTittle").text(unescape(nameCompany));
	    		$("#datepicker").attr("placeholder","Fecha propuesta: "+proposedDate)
	    		$("#agenda-form").find("#keyVisit").val(unescape(keyVisit));
	    		$("#agenda-form").find("#nameCompany").val(unescape(nameCompany));
	    		$('#right-black-shadow').animate({width:"100%"},0);
				$('#r-content').animate({right:'0px'},50);
	    	},	
			load : function (){
				if  (activities.actities_form.length){
					$('#select-filter').change(function(){
						var option, staVisit = ".staVisit" ;
						$( "#select-filter option:selected" ).each(function() {
							option = $( this ).val();
						    });
						if (option=="T"){
							$ (staVisit).each(function (){
								$(this).show();
							});
						}else{
							$ (staVisit).each(function (){
								$(this).hide();
							});
							$(staVisit+"." + option).show();
						}
					})
					activities.burger.click(menu.openLeftMenu);
					console.info("Incia activities");
				}
			}
	}
	
	
	var agenda = {
			agenda_form : $("#agenda-form"),
			closeRightAgenda : function (){
				$('#right-black-shadow').animate({width:"0"},0);
				$('#r-content').animate({right:'-500px'},50);
				$("#datepicker").val("");
				$("#timepicker").val("");
				$("#datepicker-error").remove();
				$("#timepicker-error").remove();
			},
			load : function (){
				if (agenda.agenda_form.length){
					agenda.agenda_form.validate({
						rules : {
							datepicker : {
								required : true
							},
							timepicker : {
								required : true 
							}
						},
						messages : {
							datepicker : {
								required : "La fecha es obligatoria"
							},
							timepicker : {
								required : "La hora es obligatoria" 
							}
						}
					});
					$('#right-black-shadow').click(agenda.closeRightAgenda);
					$("#rch-close").click(agenda.closeRightAgenda);
					$("#btn-save-agenda").click(function (){
						timeSplit = $("#timepicker").val().split(" ");
						$("#ampm").val(timeSplit[1]);
						timeSplit = timeSplit[0].split(":");
						$("#hours").val(timeSplit[0]);
						$("#minutes").val(timeSplit[1]);
//						message.openLoading();
						$("#agenda-form").attr('action', '/payroll-agenda/agendar');
						$("#agenda-form").submit();
					});
					$('.datepicker').pickadate({
			    	    today: 'Today',
			    	    format : 'dd/mm/yyyy',
			    	    clear: 'Limpiar',
			    	    close: 'Listo',
			    	    minDate : new Date(), 
						time: false,
			    	    closeOnSelect: false // Close upon selecting a date,
			    	});
			    	$('.timepicker').pickatime({
				        fromnow: 0,       // set default time to * milliseconds from now (using with default = 'now')
				        twelvehour: true, // Use AM/PM or 24-hour format
				        interval: 15,
				        donetext: 'Listo', // text for done-button
				        cleartext: 'Clear', // text for clear-button
				        canceltext: 'Cancel', // Text for cancel-button
				        autoclose: false, // automatic close timepicker
				        ampmclickable: false, // make AM PM clickable
				        onSet: function(){} //Function for after opening timepicker)
			    	});
			    	$("#datepicker").change(function(){
			    		if ($("#datepicker").val()!=""){
			    			$("#datepicker").removeClass("error");
			    			$("#datepicker-error").remove();
			    		}
			    	});
			    	$("#timepicker").change(function(){
			    		if ($("#timepicker").val()!=""){
			    			$("#timepicker").removeClass("error");
			    			$("#timepicker-error").remove();
			    		}
			    	});
			    	
					console.info("Incia agenda");
				}
			}
	}
	
	var company = {
			company_form : 'company-form',
			burger : $("#burger"),
			load : function (){
				if  (company.company_form.length){
					$('#select-filter').change(function(){
						var option, staVisit = ".staVisit" ;
						$( "#select-filter option:selected" ).each(function() {
							option = $( this ).val();
						    });
						if (option=="T"){
							$ (staVisit).each(function (){
								$(this).show();
							});
						}else{
							$ (staVisit).each(function (){
								$(this).hide();
							});
							$(staVisit+"." + option).show();
						}
					})
					company.burger.click(menu.openLeftMenu);
					console.info("Incia company");
				}
			}
	}
	
	var myProfile ={
			my_profile_form : 'my-profile-form',
			burger : $("#burger"),
			openRightAgenda : function (nameCompany,keyVisit,proposedDate){
	    		$('#right-black-shadow').animate({width:"100%"},0);
				$('#r-content').animate({right:'0px'},50);
	    	},
	    	closeRightAgenda : function (){
				$('#right-black-shadow').animate({width:"0"},0);
				$('#r-content').animate({right:'-500px'},50);
			},
			load : function () {
				if  (myProfile.my_profile_form.length){
			    	$("#edit-profile").click(myProfile.openRightAgenda);
					$('#right-black-shadow').click(myProfile.closeRightAgenda);
					$("#rch-close").click(myProfile.closeRightAgenda);
					myProfile.burger.click(menu.openLeftMenu);
					console.info("Incia myProfile");
				}
			}
	}
	
    return{
        inicializar: function(){
//        	message.load();
        	loginTablet.load();
        	menu.load();
        	activities.load();
        	agenda.load();
        	company.load();
        	myProfile.load();
        	initCheckbox();
        },
        'activities':activities
    }

})();

payRoll.inicializar();
